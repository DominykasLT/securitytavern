<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Deep links are a really interesting and easy-to-learn feature in Android for those beginning with bug bounties. Here's an interesting story about how I had some fun with it."><title>Hello 2024 | A Story of How Anyone Can Hack an Android App</title>
<link rel=canonical href=https://securitytavern.com/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Hello 2024 | A Story of How Anyone Can Hack an Android App"><meta property="og:description" content="Deep links are a really interesting and easy-to-learn feature in Android for those beginning with bug bounties. Here's an interesting story about how I had some fun with it."><meta property="og:url" content="https://securitytavern.com/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/"><meta property="og:site_name" content="Security Tavern"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Android"><meta property="article:tag" content="Hacking"><meta property="article:published_time" content="2023-02-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-04T00:00:00+00:00"><meta name=twitter:title content="Hello 2024 | A Story of How Anyone Can Hack an Android App"><meta name=twitter:description content="Deep links are a really interesting and easy-to-learn feature in Android for those beginning with bug bounties. Here's an interesting story about how I had some fun with it."><link rel="shortcut icon" href=img/avatar.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7b52853b18f45534d9443614ef459c6e_1563613_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Security Tavern</a></h1><h2 class=site-description>I know that I know nothing or maybe just a little bit.</h2></div></header><ol class=social-menu><li><a href=https://www.linkedin.com/in/dominykas-linkus-244063230 target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#before-explanation-a-personal-journey-into-bug-bounties>Before Explanation: A Personal Journey into Bug Bounties</a><ol><li><a href=#every-path-has-pitfalls>Every Path has Pitfalls</a></li><li><a href=#the-turning-point-a-video-on-deep-links-in-android>The Turning Point: A Video on Deep Links in Android</a></li></ol></li><li><a href=#understanding-deep-links>Understanding Deep Links</a><ol><li><a href=#deep-link-vulnerabilities>Deep Link Vulnerabilities</a><ol><li><a href=#passwordless-login>Passwordless Login</a></li><li><a href=#misconfiguration>Misconfiguration</a></li><li><a href=#csrf-cross-site-request-forgery>CSRF (Cross-Site Request Forgery)</a></li><li><a href=#password-bypass>Password Bypass</a></li><li><a href=#xss-cross-site-scripting>XSS (Cross-Site Scripting)</a></li><li><a href=#address-bar-spoofing>Address Bar Spoofing</a></li></ol></li></ol></li><li><a href=#real-story>Real Story</a><ol><li><a href=#brainstorming>Brainstorming</a></li><li><a href=#we-almost-ready-to-lunch>We Almost Ready to Lunch</a></li><li><a href=#first-catch>First Catch</a></li><li><a href=#statistics-and-results>Statistics and Results</a></li><li><a href=#hot-to-fix-that>Hot to Fix That?</a></li></ol></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/android/>Android</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/>Hello 2024 | A Story of How Anyone Can Hack an Android App</a></h2><h3 class=article-subtitle>Deep links are a really interesting and easy-to-learn feature in Android for those beginning with bug bounties. Here's an interesting story about how I had some fun with it.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 04, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>12 minute read</time></div></footer></div></header><section class=article-content><h2 id=before-explanation-a-personal-journey-into-bug-bounties>Before Explanation: A Personal Journey into Bug Bounties</h2><p>So let&rsquo;s start from the very beginning.
I work as an application security engineer and several key tasks stand out in our daily activities:</p><ol><li>Testing new features developed by our developers.</li><li>Implementing and maintaining security tools to assist both the security team and developers.</li><li>Exploring new vulnerability areas! (Vulnerabilities evolve alongside new features and tools, so we must always stay at the forefront, ready to identify potential problems as soon as possible.)</li></ol><p>To stay ahead with the third point, we employ a variety of methods:</p><ul><li>Listening to podcasts about hacking and vulnerabilities.</li><li>Searching for guides or presentations on YouTube.</li><li>Sharing our knowledge during meetings.</li><li>Reading the latest blog posts about newly discovered vulnerabilities.</li><li>Analyzing disclosed findings from bug bounty programs.</li></ul><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.0.png width=1205 height=335 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.0_hu42a24287fd848a8c3680e9f98406d708_182816_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.0_hu42a24287fd848a8c3680e9f98406d708_182816_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=359 data-flex-basis=863px></p><p>Regarding the last point, I&rsquo;ve always regarded the bug bounty space as a professional arena where tough guys look for undiscovered vulnerabilities in applications that seem perfectly protected. I&rsquo;ve always wanted to try my hand at it, so one day I decided it was time to dive in and start navigating that sea.</p><h3 id=every-path-has-pitfalls>Every Path has Pitfalls</h3><p>Initially, I started exploring various bug bounty programs without a specific plan, hopping between different companies, applications and websites. However, this approach did not yield anything significant.</p><p>So, after a few unsuccessful weeks, I decided to target less popular bug bounty programs and set my sights on applications and websites offering lower rewards. This approach led to a few simple reports, but they were not accepted due to the stringent policies of the bug bounty programs. A few more weeks went by and I had almost lost my motivation.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.00.png width=443 height=252 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.00_hue0c242191be407202bc8ba06eb9c83b1_198615_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.00_hue0c242191be407202bc8ba06eb9c83b1_198615_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=175 data-flex-basis=421px></p><p>Once again, I reviewed my plan. Even though I had reduced the number of programs, the problem remained the same — I was jumping into all sorts of different things too much! I needed to focus on one platform and its relevant issues!</p><p>So I didn’t stop there; I dedicated some of my free time to watching presentations from researchers in the past.</p><h3 id=the-turning-point-a-video-on-deep-links-in-android>The Turning Point: A Video on Deep Links in Android</h3><p>An old video from the 2017 USENIX conference, caught my attention. It detailed a vulnerability in Android&rsquo;s login flow through deep links, which could lead to application hijacking.</p><p><a class=link href=https://www.usenix.org/conference/usenixsecurity17/technical-sessions/presentation/liu target=_blank rel=noopener>https://www.usenix.org/conference/usenixsecurity17/technical-sessions/presentation/liu</a></p><p>It was the right sign at the right time for me to focus. I have always been interested in Android and even more, in how to exploit the apps on it. I just needed to dig deeper into all the details and find that needle in the haystack.</p><h2 id=understanding-deep-links>Understanding Deep Links</h2><p>Deep links facilitate seamless transitions between web and app environments on our phones. For instance, a few simple examples:</p><ul><li>Clicking a YouTube link in a browser opens the app due to a deep link.</li><li>Searching for a local McDonald&rsquo;s and calling them involves deep links that direct the call action to a phone application.</li></ul><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.1.png width=1413 height=633 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.1_hu124e465c9f778b2b0182aa266c954950_344199_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.1_hu124e465c9f778b2b0182aa266c954950_344199_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=223 data-flex-basis=535px></p><p>So, in a more specific example, if you try to open RoboMail through the Chrome browser, Android will check all applications on the device.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.2.png width=895 height=210 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.2_huce94d5a1518b656f8e979ceaeeb4bfe6_36295_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.2_huce94d5a1518b656f8e979ceaeeb4bfe6_36295_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=426 data-flex-basis=1022px></p><p>Of course, only RoboMail will respond to that and will be opened, thanks to the intent filter with a deep link in it that exists in the application&rsquo;s manifest file. Example:</p><pre><code>&lt;activity android:name=&quot;.MainActivity&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
        &lt;data android:scheme=&quot;robomail&quot; android:host=&quot;open&quot; /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre><h3 id=deep-link-vulnerabilities>Deep Link Vulnerabilities</h3><p>This is a very useful feature and it is used not only on Android but also on other platforms. However, let&rsquo;s limit ourselves to the Android theme and review the problems that can arise due to it — because all kinds of implementations have been invented with it! And if you play with it incorrectly, you can get badly burned.</p><p>Few examples:</p><h4 id=passwordless-login>Passwordless Login</h4><p>Alright, so let&rsquo;s imagine we have the RoboMail app, and this app has an implementation to log in to your account from an email letter sent to your backup email.</p><p>So in our case, a user would be able to log in without a password, because the authentication code would be passed along with a deep link. So, anyone who would have access to your email or who could steal that link from you, would be able to log in to your RoboMail account from his device.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.3.png width=784 height=452 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.3_huc04a0cdf9636dace01168caa5ab73712_56018_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.3_huc04a0cdf9636dace01168caa5ab73712_56018_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=173 data-flex-basis=416px></p><h4 id=misconfiguration>Misconfiguration</h4><p>For another example, let&rsquo;s imagine a user is tricked and redirected to a fake website, which has a malicious deep link in it.</p><p>If an attacker manages to catch an impulsive user, who clicks that button on the website, he would be redirected back to the application. And because the deep link has an incorrect token, the user could be logged out from his account.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.4.png width=797 height=457 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.4_hue8b3404ca210a1a5951bc1542f50799f_53966_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.4_hue8b3404ca210a1a5951bc1542f50799f_53966_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=174 data-flex-basis=418px></p><p>It doesn&rsquo;t look very serious — it&rsquo;s just an email provider, you would probably log in again and learn from your mistake. But that&rsquo;s the simplest thing that can be done with it.</p><h4 id=csrf-cross-site-request-forgery>CSRF (Cross-Site Request Forgery)</h4><p>The same website, the same button. The attacker catches an impulsive user who clicks on that button. The moment they do that, they send an email to a specific address, with a specific subject and message that was written in the deep link.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.5.png width=798 height=458 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.5_hu78acb76805c6d54fdea0e9113e734fa1_65887_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.5_hu78acb76805c6d54fdea0e9113e734fa1_65887_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=174 data-flex-basis=418px></p><p>That could be dangerous. Imagine if you sent something to the police department or if the attacker managed to add a photo from your gallery and send it to himself.</p><p>We are only imagining at the moment, but all these options are possible and have existed in other applications in slightly different scenarios.</p><h4 id=password-bypass>Password Bypass</h4><p>Let’s say someone takes your phone, manages to unlock it if it was locked and opens the RoboMail app. They see that an email is already saved in memory!</p><p>So, if your entire inbox is encrypted with a master key, which you obtain with your password, the attacker tries to bypass it.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.6.png width=741 height=431 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.6_hu4164bdd6d310835fe88d67ecd0e65f5e_47936_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.6_hu4164bdd6d310835fe88d67ecd0e65f5e_47936_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=171 data-flex-basis=412px></p><p>They just use a deep link for a specific section in your app (in this case, the inbox) and the application thinks that you have successfully entered your password. It finds the master key, which was saved in memory and opens the unencrypted inbox. That&rsquo;s all the attacker has to do, they&rsquo;re in.</p><h4 id=xss-cross-site-scripting>XSS (Cross-Site Scripting)</h4><p>Here&rsquo;s another example: a user receives a phishing email with a hidden malicious deep link in it. You think it’s a legitimate letter and press that button.</p><p>The moment you do that, your application processes that deep link with script code in it and because of a misconfiguration in the app&rsquo;s code, the application processes that script in the deep link as legitimate.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.7.png width=738 height=431 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.7_hub36bf1c7f9679301cb652ef343fe4ab5_50736_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.7_hub36bf1c7f9679301cb652ef343fe4ab5_50736_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=171 data-flex-basis=410px></p><p>Well, the example is not very realistic and rare, but it illustrates the principle of the attack. And such attacks could be really dangerous if the attacker forces the application to run his code from the deep link.</p><h4 id=address-bar-spoofing>Address Bar Spoofing</h4><p>And the last example from the many possible options with deep links — let’s say a user is again tricked by a hidden malicious deep link which opens an application together with a webview that looks identical to the original one. There, you are prompted to provide your login information. If you do so, you would lose your credentials to your account.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.8.png width=750 height=430 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.8_hu84f687bc1b36b4bb64342a943a7e29ab_49877_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.8_hu84f687bc1b36b4bb64342a943a7e29ab_49877_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=174 data-flex-basis=418px></p><h2 id=real-story>Real Story</h2><p>After looking at a few examples, you should already have an idea of the many different problems that can arise from this. But now, let&rsquo;s focus a little more specifically.</p><p>While listening to presentation at the 2017 USENIX conference, I heard an interesting example he mentioned about the Careem and QatarTaxi applications.</p><p>Careem has an Android app that works like Uber and is quite popular in the Middle East. It has been integrated with hotels and restaurants. The smaller player, QatarTaxi, just decided to hijack every single deep link Careem had so that users might have a chance to open QatarTaxi instead.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.9.png width=1202 height=595 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.9_hubd77abb3088284c5abed08aeae69413a_113923_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.9_hubd77abb3088284c5abed08aeae69413a_113923_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=202 data-flex-basis=484px></p><p>This triggered me to realize that Google probably allows you to do that so easily — just upload an app in the Google Play Store that would target another application&rsquo;s deep links to get their users.</p><h3 id=brainstorming>Brainstorming</h3><p>&lsquo;That’s interesting&rsquo; I thought and I tried to improvise — what else we can do if we uploaded such a malicious app that would target another application. Could an attacker manage to steal an account, for example?</p><p>Alright, let’s brainstorm how it should work. Again, we have the RoboMail app, which has the option to log in with Facebook or Google to your account.</p><p>So if a user successfully logs in to his account through Facebook or Google, he is redirected back with a deep link that holds an access token in it.</p><p>If the user is tricked and opens another app during that login flow, the attacker&rsquo;s application would get the access token along with it.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.10.png width=1253 height=545 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.10_hu19f811174ae5a4878d3c641137ef9a7b_88705_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.10_hu19f811174ae5a4878d3c641137ef9a7b_88705_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=229 data-flex-basis=551px></p><p>What does this mean? Well, my dear reader, it means that you just leaked access to your account to a malicious application. Now they can do whatever they want with your account and God bless you if you would be smart enough to change your password. That can save you if the application would terminate the old session that was provided.</p><p>How would it look in a real-life scenario? Here, you just have to choose the &lsquo;Mail&rsquo; app, because why not? Humans are curious beings, after all.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.11.png width=1269 height=569 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.11_hu4b09fa96a134472e9db2910b194cf38e_126025_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.11_hu4b09fa96a134472e9db2910b194cf38e_126025_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=223 data-flex-basis=535px></p><h3 id=we-almost-ready-to-lunch>We Almost Ready to Lunch</h3><p>Who would make this login flow vulnerable?</p><ol><li>Let&rsquo;s imagine Bob, who initiates the login flow through Facebook.</li><li>The application redirects him to the Facebook app or to a Facebook webpage in a web browser.</li><li>Now, if the user chooses the correct app, all is good and the authorization code is redirected back to the correct application.
But if a malicious app is chosen, the attacker&rsquo;s app gets the authorization code. What could happen after that? There are a few possible outcomes, but I&rsquo;ll explain the simplest one — let&rsquo;s imagine the attacker sends that deep link to his phone and the moment he receives it, he initiates the login flow on his device with the RoboMail app.</li><li>He just changes the authorization code in one of the requests that occur during communication between his app and the server.</li><li>The server validates that code with Facebook to confirm it&rsquo;s really Bob.</li><li>And after successful validation,</li><li>It sends back an access token to the attacker&rsquo;s RoboMail app, so after that, the attacker is already inside your account and can do whatever he wants.</li></ol><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.12.png width=1252 height=516 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.12_hud3fa67a290f4c0097ede036543b8cb39_129380_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.12_hud3fa67a290f4c0097ede036543b8cb39_129380_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=242 data-flex-basis=582px></p><h3 id=first-catch>First Catch</h3><p>So, after brainstorming, I turned on the first few apps that have a Facebook or Google login flow and tried it. Well, the first few apps had that problem — what a surprise. I created a report and decided to wait for an answer. As I mentioned earlier, bug bounty programs have strict rules about which vulnerabilities are considered legitimate and which are not.</p><p>The first answer came after a week, the second after two. Both were approved and were awaiting a final decision. Another big surprise!</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.13.gif width=500 height=279 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.13_hucb10177bfefca4c8fa55748f41b6b44d_1024195_480x0_resize_box_1.gif 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.13_hucb10177bfefca4c8fa55748f41b6b44d_1024195_1024x0_resize_box_1.gif 1024w" loading=lazy class=gallery-image data-flex-grow=179 data-flex-basis=430px></p><p>I didn&rsquo;t wait long, I turned on the biggest gear and started checking all the applications that are in the bug bounty programs. After all, you understand very well how many such programs there are, but how many of them are vulnerable?</p><h3 id=statistics-and-results>Statistics and Results</h3><p>So, up until now, I&rsquo;ve tested around 60 apps, of which 41 were vulnerable to that attack, which means that around 1 out of 3 applications are safe.</p><p>From the 41 tested vulnerable applications, only 1 had a Google issue (not because of the Google login flow, but because the entire login flow implementation was a mess) and the rest were with Facebook.</p><p>Now, another interesting thing: the unclear 10 applications which I tested had unique security implementations. To intercept their traffic, I had to write a manual Frida script and that&rsquo;s not so easy. Also, some of them just crashed, maybe because the app noticed that I use a rooted phone, even if I tried to hide/bypass it. So, I left them, perhaps for the future, to play with and do some experiments.</p><p>Another interesting fact: all safe applications did not have a Facebook login flow. So, is it possible to conclude that all applications with a Facebook login are vulnerable? Well, that&rsquo;s a complicated situation that I have to explain before we go forward.</p><p>In some scenarios or applications, users are vulnerable to that attack only if they are redirected to a web browser and for this to happen, the user must not have the FB app installed on their phone. In this case, the probability is much lower, but it is still a security hole.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.14.png width=1480 height=747 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.14_hu1ae9b583aa8cfa5bcd32e406f340d1c2_92194_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.14_hu1ae9b583aa8cfa5bcd32e406f340d1c2_92194_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=198 data-flex-basis=475px></p><p>So, up until now, I know that 9 reports were marked as duplicates, a few are still waiting for a decision, 16 were accepted and 14 applications were marked as not applicable or an accepted risk.</p><p>As I mentioned before, some bug bounty programs have specific rules and in this case, they did not accept my report only because it required installing that malicious app on the user&rsquo;s phone, so it was against their policy.</p><h3 id=hot-to-fix-that>Hot to Fix That?</h3><p>So, what needs to be done to make it secure and why are so many apps still vulnerable to it? I’m talking about the root of the issue which was reported quite a long time ago (2017 USENIX).</p><ol><li>Let&rsquo;s imagine Bob once more, who is initiating a login flow through Facebook.</li><li>The application redirects him to the Facebook app or to a Facebook webpage in a web browser, but this time, the application also creates a code challenge which is an encrypted code verifier — a random string using characters from letters and numbers.</li><li>Now, if the user chooses the correct app, all is still good and the authorization code is redirected back to the right application.
Nothing is wrong even if the user chooses the wrong application
Because if the user is tricked into the wrong application, the attacker doesn&rsquo;t know anything about the code_verifier.</li><li>Because only the real app knows about it and can use it in the last step before a successful login.</li><li>The server validates that authorization code and code verifier with the code_challenge which Facebook received earlier.</li><li>And after successful validation, it sends back the access token to the correct RoboMail app.</li></ol><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.15.png width=1466 height=700 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.15_hu7b96d288ce3817ebc2bbea8246e45fbc_186319_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.15_hu7b96d288ce3817ebc2bbea8246e45fbc_186319_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=209 data-flex-basis=502px></p><p>So, the fix is quite simple. Why then are all the Facebook applications that I tested still vulnerable to that?</p><p>Well, the answer seems pretty simple: Facebook is still testing this functionality.</p><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.16.png width=809 height=169 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.16_hu3fea6dbca8675a79f5531164a56bea88_26216_480x0_resize_box_3.png 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.16_hu3fea6dbca8675a79f5531164a56bea88_26216_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=478 data-flex-basis=1148px></p><h2 id=conclusion>Conclusion</h2><ul><li>Apps that have a Facebook login flow are in a very big chance still vulnerable to this.</li><li>Be careful what you&rsquo;re doing online. That’s just one issue that I disclosed, but there are many more lurking around — not even mentioning that a deep link is just one of the many functions that our phones have.</li><li>And never stop or give up on learning something new, even if you fail sometimes, as it could lead to an interesting story.</li></ul><p><img src=/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.17.gif width=498 height=227 srcset="/p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.17_hu3a0b2a6c9b04dd298b0b894b099f13e9_1506514_480x0_resize_box_1.gif 480w, /p/hello-2024-a-story-of-how-anyone-can-hack-an-android-app/1.17_hu3a0b2a6c9b04dd298b0b894b099f13e9_1506514_1024x0_resize_box_1.gif 1024w" loading=lazy class=gallery-image data-flex-grow=219 data-flex-basis=526px></p></section><footer class=article-footer><section class=article-tags><a href=/tags/android/>Android</a>
<a href=/tags/hacking/>Hacking</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//securitytavern.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Security Tavern</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>